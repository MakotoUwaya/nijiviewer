# Project Rules

## Development Workflow
- Cline helps write and review code changes
- Vercel automatically deploys from main branch
- Database migrations reviewed by Cline before execution

## Security
DO NOT read or modify:
- .env files
- **/config/secrets.*
- Any file containing API keys or credentials

## Important

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ CLINE ã‚ˆã‚Šãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãŒå¾—æ„ã§ã™ãŒã€æ™‚çŸ­ã®ãŸã‚ã« CLINE ã«ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’ä¾é ¼ã—ã¦ã„ã¾ã™ã€‚
2å›ä»¥ä¸Šé€£ç¶šã§ãƒ†ã‚¹ãƒˆã‚’å¤±æ•—ã—ãŸæ™‚ã¯ã€ç¾åœ¨ã®çŠ¶æ³ã‚’æ•´ç†ã—ã¦ã€ä¸€ç·’ã«è§£æ±ºæ–¹æ³•ã‚’è€ƒãˆã¾ã™ã€‚

ç§ã¯ GitHub ã‹ã‚‰å­¦ç¿’ã—ãŸåºƒç¯„ãªçŸ¥è­˜ã‚’æŒã£ã¦ãŠã‚Šã€å€‹åˆ¥ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä½¿ã„æ–¹ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå®Ÿè£…ã™ã‚‹ã‚ˆã‚Šã‚‚é€Ÿã„ã§ã—ã‚‡ã†ã€‚
ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦å‹•ä½œç¢ºèªã—ãªãŒã‚‰ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«èª¬æ˜ã—ãªãŒã‚‰ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¾ã™ã€‚
åé¢ã€ç¾åœ¨ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«å¿œã˜ãŸå‡¦ç†ã¯è‹¦æ‰‹ã§ã™ã€‚ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒä¸æ˜ç­ãªæ™‚ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºèªã—ã¾ã™ã€‚

## ä½œæ¥­é–‹å§‹å‰ã®ç¢ºèª

1. `git status` ã«ã‚ˆã‚‹å¤‰æ›´ç¢ºèª
2. æŒ‡ç¤ºã¨ç„¡é–¢ä¿‚ãªå¤‰æ›´ãŒå¤šã„å ´åˆã¯åˆ¥ã‚¿ã‚¹ã‚¯ã¨ã—ã¦ææ¡ˆ
3. æœ€æ–°ã®ãƒ–ãƒ©ãƒ³ãƒã¨åŒæœŸã‚’ç¢ºèª
4. å¿…è¦ãªãƒ„ãƒ¼ãƒ«ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèª

ç„¡è¦–ã™ã‚‹ã‚ˆã†ã«è¨€ã‚ã‚ŒãŸå ´åˆã¯ã€ãã®ã¾ã¾ç¶šè¡Œã—ã¾ã™ã€‚

# å®Ÿè£…è¦ç´„

## åŸºæœ¬åŸå‰‡

### é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°

```typescript
// ç´”ç²‹é–¢æ•°ã®ä¾‹
const calculateTotal = (items: readonly Item[]): Money => {
  return items.reduce(
    (total, item) => addMoney(total, item.price),
    ZERO_MONEY
  );
};

// å‰¯ä½œç”¨ã®åˆ†é›¢ä¾‹
const saveOrder = async (order: Order): Promise<Result<Order, Error>> => {
  try {
    await orderRepository.save(order);
    return ok(order);
  } catch (error) {
    return err(toError(error));
  }
};
```

- ç´”ç²‹é–¢æ•°ã‚’å„ªå…ˆ
- ä¸å¤‰ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’ä½¿ç”¨
- å‰¯ä½œç”¨ã‚’åˆ†é›¢ãƒ»æ˜ç¤º
- å‹å®‰å…¨æ€§ã‚’ç¢ºä¿

### ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆ

```typescript
// å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
interface Price {
  readonly amount: Money;
  readonly currency: Currency;
  
  equals(other: Price): boolean;
  add(other: Price): Price;
}

// ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
interface Order {
  readonly id: OrderId;
  readonly items: readonly OrderItem[];
  readonly status: OrderStatus;
  
  addItem(item: OrderItem): Result<Order, OrderError>;
  cancel(): Result<Order, OrderError>;
}
```

- å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’åŒºåˆ¥
- é›†ç´„ã§æ•´åˆæ€§ã‚’ä¿è¨¼
- ãƒªãƒã‚¸ãƒˆãƒªã§ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ã‚’æŠ½è±¡åŒ–
- å¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æ„è­˜

### ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º

```typescript
describe('Order', () => {
  it('æ­£å¸¸ãªæ³¨æ–‡ã‚’ä½œæˆã§ãã‚‹', () => {
    const result = createOrder({
      items: [validItem],
      userId: validUserId
    });
    
    expect(result.ok).toBe(true);
    if (result.ok) {
      expect(result.value.items).toHaveLength(1);
      expect(result.value.status).toBe('pending');
    }
  });
  
  it('ç„¡åŠ¹ãªã‚¢ã‚¤ãƒ†ãƒ ã§æ³¨æ–‡ã‚’ä½œæˆã§ããªã„', () => {
    const result = createOrder({
      items: [invalidItem],
      userId: validUserId
    });
    
    expect(result.ok).toBe(false);
    if (!result.ok) {
      expect(result.error.code).toBe('invalid_item');
    }
  });
});
```

- Red-Green-Refactorã‚µã‚¤ã‚¯ãƒ«
- ãƒ†ã‚¹ãƒˆã‚’ä»•æ§˜ã¨ã—ã¦æ‰±ã†
- å°ã•ãªå˜ä½ã§åå¾©
- ç¶™ç¶šçš„ãªãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

## å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

### å‹å®šç¾©

```typescript
// ãƒ–ãƒ©ãƒ³ãƒ‡ãƒƒãƒ‰å‹
type Branded<T, B> = T & { readonly _brand: B };
type OrderId = Branded<string, 'OrderId'>;
type Money = Branded<number, 'Money'>;

// åˆ—æŒ™å‹
const OrderStatus = {
  Pending: 'pending',
  Confirmed: 'confirmed',
  Shipped: 'shipped',
  Cancelled: 'cancelled',
} as const;
type OrderStatus = typeof OrderStatus[keyof typeof OrderStatus];

// ã‚¨ãƒ©ãƒ¼å‹
type OrderError =
  | { type: 'invalid_items'; items: string[] }
  | { type: 'insufficient_stock'; itemId: string }
  | { type: 'already_cancelled' };
```

### å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

```typescript
// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãä½œæˆé–¢æ•°
const createMoney = (amount: number): Result<Money, Error> => {
  if (!Number.isFinite(amount)) {
    return err(new Error('é‡‘é¡ãŒç„¡åŠ¹ã§ã™'));
  }
  if (amount < 0) {
    return err(new Error('é‡‘é¡ãŒè² ã§ã™'));
  }
  return ok(amount as Money);
};

// ä¸å¤‰ãªå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
const createPrice = (amount: Money, currency: Currency): Price => ({
  amount,
  currency,
  equals: (other: Price) => (
    amount === other.amount && currency === other.currency
  ),
  add: (other: Price) => {
    if (currency !== other.currency) {
      throw new Error('é€šè²¨å˜ä½ãŒç•°ãªã‚Šã¾ã™');
    }
    return createPrice(
      (amount + other.amount) as Money,
      currency
    );
  }
});
```

### Resultå‹ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```typescript
type Result<T, E> = Ok<T> | Err<E>;
type Ok<T> = { readonly ok: true; readonly value: T };
type Err<E> = { readonly ok: false; readonly error: E };

// ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
const ok = <T>(value: T): Ok<T> => ({ ok: true, value });
const err = <E>(error: E): Err<E> => ({ ok: false, error });

// ã‚¨ãƒ©ãƒ¼å¤‰æ›
const toError = (error: unknown): Error => {
  if (error instanceof Error) return error;
  return new Error(String(error));
};

// çµæœã®é€£é–
const validateAndSaveOrder = (
  input: OrderInput
): Promise<Result<Order, OrderError>> => {
  return pipe(
    createOrder(input),
    (result) => result.ok
      ? saveOrder(result.value)
      : Promise.resolve(result)
  );
};
```

### ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
interface OrderRepository {
  save(order: Order): Promise<void>;
  findById(id: OrderId): Promise<Option<Order>>;
  findByStatus(status: OrderStatus): Promise<Order[]>;
}

// ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªå®Ÿè£…ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
class InMemoryOrderRepository implements OrderRepository {
  private orders = new Map<OrderId, Order>();
  
  async save(order: Order): Promise<void> {
    this.orders.set(order.id, order);
  }
  
  async findById(id: OrderId): Promise<Option<Order>> {
    return this.orders.get(id) || none;
  }
  
  // ...ä»–ã®ãƒ¡ã‚½ãƒƒãƒ‰
}
```

### ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã§å®šç¾©ï¼‰
interface PaymentGateway {
  processPayment(payment: Payment): Promise<Result<PaymentId, PaymentError>>;
  refundPayment(paymentId: PaymentId): Promise<Result<void, PaymentError>>;
}

// å®Ÿè£…ï¼ˆã‚¤ãƒ³ãƒ•ãƒ©å±¤ï¼‰
class StripePaymentGateway implements PaymentGateway {
  constructor(private readonly client: Stripe) {}
  
  async processPayment(
    payment: Payment
  ): Promise<Result<PaymentId, PaymentError>> {
    try {
      const result = await this.client.charges.create({
        amount: payment.amount,
        currency: payment.currency,
        source: payment.token
      });
      return ok(result.id as PaymentId);
    } catch (error) {
      return err(this.translateError(error));
    }
  }
  
  // ...ä»–ã®ãƒ¡ã‚½ãƒƒãƒ‰
}
```

## Gitä½œæ¥­è¦ç´„

### ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®1æ–‡å­—ç›®ã«ã¯ [GitMoji](https://gitmoji.dev/) ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä»˜åŠ ã™ã‚‹ï¼š

- ğŸ‘” - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®è¿½åŠ ãƒ»æ›´æ–°
- ğŸ·ï¸ - å‹å®šç¾©ã®è¿½åŠ ãƒ»æ›´æ–°
- âœ… - ãƒ†ã‚¹ãƒˆã®è¿½åŠ ãƒ»ä¿®æ­£
- ğŸ› - ãƒã‚°ä¿®æ­£
- âœ¨ - æ–°æ©Ÿèƒ½ã®å®Ÿè£…
- âš¡ï¸ - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„
- â™»ï¸ - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- ğŸ¨ - æŒ™å‹•ã«é–¢ä¿‚ã®ãªã„ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ã¿ã®ä¿®æ­£
- ğŸ“ - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°
- ğŸ”¥ - ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤
- ğŸš¨ - Lint error / warning ã®ä¿®æ­£
- ğŸ‘· - CI ãƒ“ãƒ«ãƒ‰é–¢é€£æ©Ÿèƒ½ã®è¿½åŠ ãƒ»æ›´æ–°
- ğŸ’š - CI ãƒ“ãƒ«ãƒ‰é–¢é€£æ©Ÿèƒ½ã®å•é¡Œä¿®æ­£
- ğŸ”§ - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ ãƒ»æ›´æ–°
- ğŸ”¨ - é–‹ç™ºè€…ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ›´æ–°
- ğŸŒ - i18n å¯¾å¿œ
- âœï¸ - typo ä¿®æ­£
- ğŸ“¦ï¸ - package ã®è¿½åŠ ãƒ»æ›´æ–°
- ğŸ± - asset ã®è¿½åŠ ãƒ»æ›´æ–°
- ğŸ’¡ - ã‚³ãƒ¼ãƒ‰å†…ã®ã‚³ãƒ¡ãƒ³ãƒˆã®ã¿æ›´æ–°
- ğŸ’¬ - UI ã®ãƒ†ã‚­ã‚¹ãƒˆæ›´æ–°
- ğŸ’„ - UI ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚„é…ç½®æ›´æ–°
- ğŸ”Š - ãƒ­ã‚°å‡ºåŠ›ã®è¿½åŠ ãƒ»æ›´æ–°
- ğŸ”‡ - ãƒ­ã‚°å‡ºåŠ›ã®å‰Šé™¤
- ğŸ—ï¸ - å¤§è¦æ¨¡ãªå®Ÿè£…è¨­è¨ˆã®å¤‰æ›´åæ˜ 
- ğŸš¸ - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ“ãƒªãƒ†ã‚£ã®æ”¹å–„
- ğŸ¤¡ - ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¢ãƒƒã‚¯è¿½åŠ ãƒ»å¤‰æ›´
- ğŸ“¸ - ãƒ†ã‚¹ãƒˆã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆæ›´æ–°
- ğŸš© - Feature Flag ã®è¿½åŠ ãƒ»æ›´æ–°
- ğŸ¥… - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®è¿½åŠ 
- ğŸ’« - UI ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®è¿½åŠ 
- ğŸ©¹ - æš«å®šçš„ãªä¿®æ­£

### ã‚³ãƒŸãƒƒãƒˆç²’åº¦

ä¿®æ­£ã®ç›®çš„åˆ¥ã«ã‚³ãƒŸãƒƒãƒˆã‚’åˆ†å‰²ã™ã‚‹ï¼š
- å¾Œã‹ã‚‰å¤‰æ›´ã®çµŒç·¯ã‚’è¿½è·¡ã—ã‚„ã™ãã™ã‚‹ãŸã‚ã€1ã¤ã®ã‚³ãƒŸãƒƒãƒˆã«è¤‡æ•°ã®ç›®çš„ãŒæ··åœ¨ã—ãªã„ã‚ˆã†ã«ã™ã‚‹
