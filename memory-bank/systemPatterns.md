# システムパターン

## アーキテクチャ概要

```mermaid
graph TD
    Client[クライアント層] --> Next[Next.js App Router]
    Next --> API[APIレイヤー]
    API --> External[外部API]
    API --> DB[Supabase]

    subgraph "フロントエンド"
        Client
        Next
    end

    subgraph "バックエンド"
        API
        External[Holodex API]
        DB
    end
```

## 設計原則

1. 関数型プログラミング

   - 純粋関数の優先
   - 不変データ構造の使用
   - 副作用の分離と明示
   - 型安全性の確保

2. コンポーネント設計

   - 単一責任の原則
   - 再利用可能なUIコンポーネント
   - アトミックデザインの採用
   - Propsによる明示的なデータフロー
   - 情報表示のベストプラクティス
     - テキスト表示の制限（line-clamp）
     - アイコンによる視覚的情報伝達
     - 数値の適切なフォーマット（toLocaleString）
     - 条件付きレンダリングによるフォールバック
     - UI テキストの言語統一
       - 基本的に英語を使用
       - エラーメッセージ、ボタンラベル、プレースホルダーなど
       - 例外: ユーザーコンテンツ、固有名詞

3. 状態管理
   - サーバーサイドの状態管理
   - クライアントサイドの最小化
   - キャッシュ戦略の活用

## データフロー

```mermaid
graph LR
    User[ユーザー操作] --> Page[ページコンポーネント]
    Page --> Server[サーバーコンポーネント]
    Server --> API[API呼び出し]
    API --> Cache[キャッシュ層]
    Cache --> DB[データストア]
```

## エラーハンドリング

1. 境界でのバリデーション

   - APIリクエストの検証
   - ユーザー入力の検証
   - 型チェックの活用

2. エラー表示
   - ユーザーフレンドリーなエラーメッセージ
   - デバッグ情報のログ記録
   - エラー回復の提案

## パフォーマンス最適化

1. ビルド時最適化

   - 画像の最適化
   - バンドルサイズの最小化
   - コード分割の活用

2. ランタイム最適化

   - キャッシュの活用
   - 遅延ローディング
   - ストリーミング対応

3. メトリクス監視
   - Core Web Vitals
   - エラーレート
   - パフォーマンスモニタリング
