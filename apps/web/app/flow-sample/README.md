# React Flow with Loro CRDT Sync

このサンプルは、React Flow と Loro CRDT を組み合わせて、リアルタイムでフローチャートを同期する機能を実装しています。

## 機能

### 基本機能

- **ノードの追加・移動・削除**: React Flow の標準機能
- **エッジの作成・削除**: ノード間の接続線の管理
- **ダークモード対応**: テーマに応じた表示切り替え

### 同期機能（Loro CRDT）

- **リアルタイム同期**: 複数のタブ/ウィンドウ間でのリアルタイム同期
- **自動保存**: 変更内容の自動的なローカルストレージへの保存
- **エクスポート/インポート**: ドキュメントのファイル形式での保存・読み込み
- **競合解決**: CRDT による自動的な競合解決

## 使用方法

### 基本操作

1. **ノードの移動**: ノードをドラッグして移動
2. **エッジの作成**: ノードの端点をドラッグして他のノードに接続
3. **ノードの追加**: 「Add Node」ボタンでランダムな位置にノードを追加
4. **リセット**: 「Reset」ボタンで初期状態に戻す

### 同期機能

1. **複数タブでの同期**:

   - 同じブラウザで複数のタブを開く
   - 一方のタブで変更すると、他のタブにも自動的に反映される

2. **ドキュメントの保存・読み込み**:

   - 「Export」ボタンで現在の状態を`.loro`ファイルとして保存
   - 「Import」ボタンで保存したファイルを読み込み

3. **自動保存**:
   - 変更は自動的にローカルストレージに保存される
   - ページをリロードしても状態が復元される

## 技術詳細

### Loro CRDT

- **CRDT (Conflict-free Replicated Data Type)**: 競合のない複製データ型
- **LoroDoc**: メインのドキュメントオブジェクト
- **LoroList**: ノードとエッジのリストを管理
- **自動同期**: 変更の自動検出と同期

### 実装のポイント

1. **状態管理**: React State と Loro CRDT の双方向同期
2. **競合回避**: `isUpdatingFromLoroRef`フラグによる無限ループの防止
3. **永続化**: ローカルストレージを使用した状態の永続化
4. **型安全性**: TypeScript による型安全な実装

## 拡張可能性

### WebSocket 統合

現在はローカルストレージベースの同期ですが、WebSocket サーバーと組み合わせることで、異なるデバイス間での同期も可能です。

### カスタムノード

React Flow のカスタムノード機能と組み合わせて、より複雑なノードタイプも同期できます。

### 履歴管理

Loro の履歴機能を使用して、変更履歴の表示や undo/redo 機能も実装可能です。

## 参考リンク

- [Loro Documentation](https://loro.dev/docs)
- [React Flow Documentation](https://reactflow.dev/learn)
- [CRDT について](https://crdt.tech/)
